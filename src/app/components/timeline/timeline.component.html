<!-- Timeline Header: Title, Timescale Selector, Today Button -->
<app-timeline-header
  [currentTimescale]="timescale"
  (timescaleChange)="onTimescaleChange($event)"
  (todayClick)="scrollToToday()"
/>

<!-- Main Timeline Table -->
<div class="timeline-container">
  <div class="timeline-scroll-wrapper" #timelineScroll>
    <table class="timeline-table" [style.width.px]="totalTimelineWidth">
      <thead>
        <tr>
          <th class="work-center-header">Work Center</th>
          <th
            *ngFor="let col of columns; trackBy: trackByColumn"
            class="column-header"
            [class.current-period]="isCurrentPeriod(col)"
            [style.width.px]="columnWidth"
          >
            {{ col.label }}
          </th>
        </tr>
      </thead>
      <tbody>
        <tr
          *ngFor="let center of workCenters; trackBy: trackByCenter; let isFirst = first"
          class="timeline-row"
          [class.hovered]="hoveredRowId === center.docId"
          (mouseenter)="onRowHover(center.docId)"
          (mouseleave)="onRowHover(null)"
        >
          <td class="work-center-cell">
            <span class="work-center-name">{{ center.data.name }}</span>
          </td>
          <td
            *ngFor="let col of columns; trackBy: trackByColumn"
            class="column-cell"
            [class.current-period]="isCurrentPeriod(col)"
            [style.width.px]="columnWidth"
            (click)="onTimelineClick($event, center.docId)"
          >
            <!-- Current period pill (only in first row, month view only) -->
            <app-pill
              class="current-period-pill"
              *ngIf="isFirst && isCurrentPeriod(col) && timescale === 'Month'"
              text="This month"
            />

            <!-- "Click to add" hint for empty rows -->
            <app-pill
              class="click-to-add"
              *ngIf="hoveredRowId === center.docId && getOrdersForCenter(center.docId).length === 0 && col === columns[0]"
              text="+ Click to add"
              textColor="var(--text-disabled)"
              bgColor="var(--bg-light)"
            />

            <!-- Work Order Bars (only rendered in first cell, positioned absolutely) -->
            <ng-container *ngIf="col === columns[0]">
              <app-work-order-bar
                *ngFor="let order of getOrdersForCenter(center.docId); trackBy: trackByOrder"
                [order]="order"
                [leftPx]="calcBarStyle(order).left"
                [widthPx]="calcBarStyle(order).width"
                (edit)="onEditOrder($event)"
                (delete)="onDeleteOrder($event)"
              />
            </ng-container>
          </td>
        </tr>
        <!-- Filler row to take up remaining vertical space -->
        <tr class="filler-row">
          <td class="work-center-cell filler-cell"></td>
          <td class="column-cell filler-cell" *ngFor="let col of columns; trackBy: trackByColumn"></td>
        </tr>
      </tbody>
    </table>

    <!-- Current Day Indicator -->
    <div
      class="today-indicator"
      [style.left.px]="todayPosition"
    >
      <div class="today-label">{{ todayLabel }}</div>
      <div class="today-line"></div>
    </div>
  </div>
</div>

<!-- Slide-out Panel for Create/Edit -->
<app-slide-panel
  *ngIf="panelOpen"
  [mode]="panelMode"
  [workCenterId]="panelWorkCenterId"
  [startDate]="panelStartDate"
  [editingOrder]="editingOrder"
  (close)="onPanelClose()"
  (saved)="onPanelSave()"
/>

<!-- Backdrop overlay when panel is open -->
<div
  class="panel-backdrop"
  *ngIf="panelOpen"
  (click)="onPanelClose()"
  @fadeIn
></div>
