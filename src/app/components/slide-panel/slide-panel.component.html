<div class="slide-panel" @slideIn (@slideIn.done)="onAnimationDone($event)" *ngIf="!isLeaving" role="dialog"
  aria-modal="true" aria-labelledby="panel-title" aria-describedby="panel-subtitle">

  <header class="panel-header">
    <div class="panel-title-group">
      <h2 class="panel-title" id="panel-title">{{ editingOrder ? 'Edit' : 'New' }} Work Order</h2>
      <p class="panel-subtitle" id="panel-subtitle">Specify the details for this order</p>
    </div>
    <div class="panel-actions">
      <button class="btn-cancel" (click)="onCancel()" type="button" aria-label="Cancel and close">Cancel</button>
      <button class="btn-primary" (click)="onSubmit()"
        [attr.aria-label]="editingOrder ? 'Save changes' : 'Create work order'">
        {{ editingOrder ? 'Save' : 'Create' }}
      </button>
    </div>
  </header>

  <div class="error-alert" *ngIf="form.touched && (form.invalid || overlapError)" role="alert" aria-live="assertive">
    <span *ngIf="overlapError; else dateRangeError">
      {{ overlapError }}
    </span>

    <ng-template #dateRangeError>
      <span *ngIf="form.hasError('dateRange'); else genericError">
        Please enter a valid date range
      </span>
    </ng-template>

    <ng-template #genericError>
      Form field validation error - all fields are required
    </ng-template>
  </div>

  <form [formGroup]="form" (ngSubmit)="onSubmit()" class="work-order-form">

    <div class="form-group">
      <label class="form-label" for="wo-name">Work Order Name</label>
      <input id="wo-name" class="form-input" formControlName="name" aria-required="true"
        [attr.aria-invalid]="form.get('name')?.invalid && form.get('name')?.touched" />
    </div>

    <div class="form-group">
      <label class="form-label" id="status-label">Status</label>
      <ng-select formControlName="status" [items]="statusOptions" [clearable]="false" [searchable]="false"
        bindValue="value" aria-labelledby="status-label" aria-required="true">
        <ng-template ng-label-tmp let-item="item">
          <app-pill [text]="item.label" [textColor]="item.textColor" [bgColor]="item.bgColor" />
        </ng-template>
      </ng-select>
    </div>

    <ng-container *ngFor="let field of ['startDate', 'endDate']">
      <div class="form-group">
        <label class="form-label" [id]="field + '-label'">{{ field === 'startDate' ? 'Start' : 'End' }} Date</label>
        <div class="date-input-wrapper" (click)="dp.toggle()" role="button" [attr.aria-labelledby]="field + '-label'">
          <input class="form-input date-display" readonly [value]="formatDate(form.get(field)?.value)"
            aria-readonly="true" [attr.aria-invalid]="form.hasError('dateRange') && form.touched" />
          <input type="text" class="date-hidden" ngbDatepicker #dp="ngbDatepicker" [formControlName]="field"
            aria-hidden="true" />
        </div>
      </div>
    </ng-container>

  </form>
</div>